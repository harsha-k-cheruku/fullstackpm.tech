{% extends "base.html" %}

<!-- NOTE: This is a PRIVATE/UNEXPOSED page for personal use only -->
<!-- Access via: /tools/sde-prep/intensive-8-week -->
<!-- Data persists across devices via backend API -->

{% block title %}8-Week Intensive Job Search Prep{% endblock %}

{% block description %}Comprehensive 8-week intensive SDE job search preparation plan with hourly breakdown, 180+ coding problems, system design mastery, and strategic applications.{% endblock %}

{% block content %}
  <!-- Simple Navigation -->
  <div style="margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border);">
    <a href="/tools/sde-prep/weekly-plan" style="color: var(--color-accent); text-decoration: none; font-weight: 500;">← Back to 12-Week Plan</a>
  </div>

  <!-- Header -->
  <div style="margin-bottom: 2rem;">
    <p style="color: var(--color-accent); font-size: 0.875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.5rem;">Personal Use</p>
    <h1 style="color: var(--color-text-primary); font-size: 2.25rem; font-weight: bold; margin-bottom: 1rem;">8-Week Intensive Job Search Prep</h1>
    <p style="color: var(--color-text-secondary); font-size: 1rem; margin-bottom: 2rem;">180+ coding problems • 6 system designs • 10+ STAR stories • 120+ applications</p>

    <!-- Quick Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
      <div style="padding: 1rem; background-color: var(--color-bg-secondary); border-radius: 0.5rem; border: 1px solid var(--color-border);">
        <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Total Coding Problems</p>
        <p style="color: var(--color-accent); font-size: 1.5rem; font-weight: bold;">180+</p>
      </div>
      <div style="padding: 1rem; background-color: var(--color-bg-secondary); border-radius: 0.5rem; border: 1px solid var(--color-border);">
        <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">System Designs</p>
        <p style="color: var(--color-accent); font-size: 1.5rem; font-weight: bold;">6+</p>
      </div>
      <div style="padding: 1rem; background-color: var(--color-bg-secondary); border-radius: 0.5rem; border: 1px solid var(--color-border);">
        <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Job Applications</p>
        <p style="color: var(--color-accent); font-size: 1.5rem; font-weight: bold;">120+</p>
      </div>
      <div style="padding: 1rem; background-color: var(--color-bg-secondary); border-radius: 0.5rem; border: 1px solid var(--color-border);">
        <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Expected Offers</p>
        <p style="color: var(--color-accent); font-size: 1.5rem; font-weight: bold;">3-5</p>
      </div>
    </div>
  </div>

  <!-- Week Selector -->
  <div style="margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
    <label style="color: var(--color-text-primary); font-weight: 600;">Select Week:</label>
    <select id="weekSelector" onchange="selectWeek(this.value)" style="padding: 0.5rem 1rem; background-color: var(--color-bg-primary); color: var(--color-text-primary); border: 1px solid var(--color-border); border-radius: 0.5rem; font-family: inherit; cursor: pointer;">
      <option value="">-- All Weeks --</option>
      <option value="1">Week 1: Foundation, Resume & LinkedIn</option>
      <option value="2">Week 2: Trees, Graphs & System Design Intro</option>
    </select>
    <div style="margin-left: auto;">
      <a href="/tools/sde-prep/intensive-tracker" style="padding: 0.5rem 1rem; background-color: var(--color-accent); color: white; border-radius: 0.5rem; text-decoration: none; font-weight: 500; cursor: pointer;">View Tracker →</a>
    </div>
  </div>

  <!-- Weeks Container -->
  <div id="weeksContainer" style="space-y: 2rem;">
    <!-- Week items will be inserted here -->
  </div>
{% endblock %}

{% block scripts %}
  <script>
    let curriculumData = null;

    async function loadCurriculum() {
      try {
        const response = await fetch('/static/data/curriculum-8-week-intensive.json');
        curriculumData = await response.json();
        renderWeeks();
      } catch (error) {
        console.error('Error loading curriculum:', error);
        document.getElementById('weeksContainer').innerHTML = '<p style="color: var(--color-text-secondary);">Error loading curriculum data</p>';
      }
    }

    function renderWeeks() {
      const selectedWeek = document.getElementById('weekSelector').value;
      const container = document.getElementById('weeksContainer');
      container.innerHTML = '';

      if (!curriculumData) return;

      const weeksToShow = selectedWeek
        ? curriculumData.weeks.filter(w => w.week == selectedWeek)
        : curriculumData.weeks;

      weeksToShow.forEach(week => {
        container.appendChild(createWeekElement(week));
      });
    }

    function createWeekElement(week) {
      const weekDiv = document.createElement('div');
      weekDiv.style.marginBottom = '2rem';

      const weekHeader = document.createElement('div');
      weekHeader.style.cssText = `
        padding: 1.5rem;
        background-color: var(--color-bg-secondary);
        border-radius: 0.75rem;
        border: 1px solid var(--color-border);
        cursor: pointer;
        transition: background-color 0.2s;
      `;
      weekHeader.onmouseover = function() { this.style.opacity = '0.8'; };
      weekHeader.onmouseout = function() { this.style.opacity = '1'; };

      const headerContent = document.createElement('div');
      headerContent.style.cssText = 'display: flex; justify-content: space-between; align-items: start;';

      const titleDiv = document.createElement('div');
      const title = document.createElement('h3');
      title.style.cssText = 'color: var(--color-text-primary); font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;';
      title.textContent = week.title;

      const description = document.createElement('p');
      description.style.cssText = 'color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 1rem;';
      description.textContent = week.description;

      const goalsDiv = document.createElement('div');
      goalsDiv.style.marginTop = '1rem';
      const goalsLabel = document.createElement('p');
      goalsLabel.style.cssText = 'color: var(--color-text-secondary); font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;';
      goalsLabel.textContent = 'Weekly Goals:';
      goalsDiv.appendChild(goalsLabel);

      const goalsList = document.createElement('ul');
      goalsList.style.cssText = 'margin-left: 1rem; color: var(--color-text-secondary); font-size: 0.875rem;';
      week.goals.forEach(goal => {
        const li = document.createElement('li');
        li.style.cssText = 'list-style-type: disc; margin-bottom: 0.25rem;';
        li.textContent = goal;
        goalsList.appendChild(li);
      });
      goalsDiv.appendChild(goalsList);

      titleDiv.appendChild(title);
      titleDiv.appendChild(description);
      titleDiv.appendChild(goalsDiv);

      const caretSpan = document.createElement('span');
      caretSpan.id = `caret-week-${week.week}`;
      caretSpan.style.cssText = 'color: var(--color-text-secondary); font-size: 1.5rem; transition: transform 0.2s;';
      caretSpan.textContent = '▼';

      headerContent.appendChild(titleDiv);
      headerContent.appendChild(caretSpan);
      weekHeader.appendChild(headerContent);

      weekHeader.onclick = function() {
        toggleWeekExpand(week.week);
      };

      weekDiv.appendChild(weekHeader);

      const daysContainer = document.createElement('div');
      daysContainer.id = `days-${week.week}`;
      daysContainer.style.display = 'none';
      daysContainer.style.marginTop = '1rem';

      week.days.forEach(day => {
        daysContainer.appendChild(createDayElement(day, week.week));
      });

      weekDiv.appendChild(daysContainer);
      return weekDiv;
    }

    function createDayElement(day, weekNum) {
      const dayDiv = document.createElement('div');
      dayDiv.style.marginBottom = '1rem';

      const dayHeader = document.createElement('div');
      dayHeader.style.cssText = `
        padding: 1rem;
        background-color: var(--color-bg-tertiary);
        border-radius: 0.5rem;
        border: 1px solid var(--color-border);
        cursor: pointer;
        transition: background-color 0.2s;
      `;
      dayHeader.onmouseover = function() { this.style.opacity = '0.8'; };
      dayHeader.onmouseout = function() { this.style.opacity = '1'; };

      const dayHeaderContent = document.createElement('div');
      dayHeaderContent.style.cssText = 'display: flex; justify-content: space-between; align-items: center;';

      const dayInfo = document.createElement('div');
      const dayTitle = document.createElement('h4');
      dayTitle.style.cssText = 'color: var(--color-text-primary); font-weight: 600; margin-bottom: 0.25rem;';
      dayTitle.textContent = day.day;

      const dayDesc = document.createElement('p');
      dayDesc.style.cssText = 'color: var(--color-text-secondary); font-size: 0.875rem;';
      dayDesc.textContent = day.title;

      dayInfo.appendChild(dayTitle);
      dayInfo.appendChild(dayDesc);

      const caret = document.createElement('span');
      caret.id = `caret-day-${day.day}`;
      caret.style.cssText = 'color: var(--color-text-secondary); font-size: 1.25rem; transition: transform 0.2s;';
      caret.textContent = '▼';

      dayHeaderContent.appendChild(dayInfo);
      dayHeaderContent.appendChild(caret);
      dayHeader.appendChild(dayHeaderContent);

      dayHeader.onclick = function() {
        toggleDayExpand(day.day);
      };

      dayDiv.appendChild(dayHeader);

      const tasksContainer = document.createElement('div');
      tasksContainer.id = `tasks-${day.day}`;
      tasksContainer.style.cssText = 'display: none; margin-top: 0.5rem; padding-left: 1rem; border-left: 2px solid var(--color-border);';

      day.tasks.forEach(task => {
        tasksContainer.appendChild(createTaskElement(task, day.day));
      });

      dayDiv.appendChild(tasksContainer);
      return dayDiv;
    }

    function createTaskElement(task, dayDate) {
      const taskDiv = document.createElement('div');
      taskDiv.style.cssText = `
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background-color: var(--color-bg-primary);
        border: 1px solid var(--color-border);
        border-radius: 0.375rem;
        display: flex;
        align-items: start;
        gap: 0.75rem;
      `;

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = task.completed || false;
      checkbox.style.cssText = 'margin-top: 0.25rem; cursor: pointer; width: 20px; height: 20px;';
      checkbox.onchange = function() {
        saveTaskProgress(task.id, this.checked);
      };

      const content = document.createElement('div');
      content.style.flex = '1';

      const taskTitle = document.createElement('p');
      taskTitle.style.cssText = `color: var(--color-text-primary); font-weight: 500; margin-bottom: 0.25rem; ${task.completed ? 'text-decoration: line-through; color: var(--color-text-secondary);' : ''}`;
      taskTitle.textContent = task.title;

      const taskDesc = document.createElement('p');
      taskDesc.style.cssText = 'color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;';
      taskDesc.textContent = task.description;

      const taskMeta = document.createElement('div');
      taskMeta.style.cssText = 'display: flex; gap: 1rem; flex-wrap: wrap;';

      const timeDiv = document.createElement('span');
      timeDiv.style.cssText = 'color: var(--color-text-secondary); font-size: 0.75rem;';
      timeDiv.textContent = `⏱️ ${task.minutes} min`;
      taskMeta.appendChild(timeDiv);

      if (task.difficulty) {
        const diffSpan = document.createElement('span');
        diffSpan.style.cssText = `color: var(--color-text-secondary); font-size: 0.75rem; padding: 0.25rem 0.5rem; background-color: var(--color-bg-secondary); border-radius: 0.25rem;`;
        diffSpan.textContent = task.difficulty;
        taskMeta.appendChild(diffSpan);
      }

      if (task.leetcodeNumber) {
        const leetcodeLink = document.createElement('a');
        leetcodeLink.href = `https://leetcode.com/problems/${task.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`;
        leetcodeLink.target = '_blank';
        leetcodeLink.style.cssText = 'color: var(--color-accent); font-size: 0.75rem; text-decoration: none;';
        leetcodeLink.textContent = `LeetCode #${task.leetcodeNumber}`;
        taskMeta.appendChild(leetcodeLink);
      }

      content.appendChild(taskTitle);
      content.appendChild(taskDesc);
      content.appendChild(taskMeta);

      if (task.resources && task.resources.length > 0) {
        const resourcesDiv = document.createElement('div');
        resourcesDiv.style.cssText = 'margin-top: 0.5rem;';
        const resourcesLabel = document.createElement('p');
        resourcesLabel.style.cssText = 'color: var(--color-text-secondary); font-size: 0.75rem; font-weight: 500; margin-bottom: 0.25rem;';
        resourcesLabel.textContent = 'Resources:';
        resourcesDiv.appendChild(resourcesLabel);

        const resourcesList = document.createElement('div');
        resourcesList.style.cssText = 'display: flex; gap: 0.5rem; flex-wrap: wrap;';
        task.resources.forEach(resource => {
          const resourceLink = document.createElement('a');
          resourceLink.href = resource.url;
          resourceLink.target = '_blank';
          resourceLink.style.cssText = 'color: var(--color-accent); font-size: 0.75rem; text-decoration: none; padding: 0.25rem 0.5rem; background-color: var(--color-bg-secondary); border-radius: 0.25rem;';
          resourceLink.textContent = resource.title;
          resourcesList.appendChild(resourceLink);
        });
        resourcesDiv.appendChild(resourcesList);
        content.appendChild(resourcesDiv);
      }

      if (task.notes) {
        const notesDiv = document.createElement('div');
        notesDiv.style.cssText = 'margin-top: 0.5rem; padding: 0.5rem; background-color: var(--color-bg-secondary); border-radius: 0.25rem; border-left: 2px solid var(--color-accent);';
        const notesLabel = document.createElement('p');
        notesLabel.style.cssText = 'color: var(--color-text-secondary); font-size: 0.75rem; font-weight: 500; margin-bottom: 0.25rem;';
        notesLabel.textContent = 'Note:';
        const notesContent = document.createElement('p');
        notesContent.style.cssText = 'color: var(--color-text-secondary); font-size: 0.75rem;';
        notesContent.textContent = task.notes;
        notesDiv.appendChild(notesLabel);
        notesDiv.appendChild(notesContent);
        content.appendChild(notesDiv);
      }

      taskDiv.appendChild(checkbox);
      taskDiv.appendChild(content);

      return taskDiv;
    }

    function toggleWeekExpand(weekNum) {
      const container = document.getElementById(`days-${weekNum}`);
      const caret = document.getElementById(`caret-week-${weekNum}`);
      if (container.style.display === 'none') {
        container.style.display = 'block';
        caret.style.transform = 'rotate(180deg)';
      } else {
        container.style.display = 'none';
        caret.style.transform = 'rotate(0deg)';
      }
    }

    function toggleDayExpand(dayDate) {
      const container = document.getElementById(`tasks-${dayDate}`);
      const caret = document.getElementById(`caret-day-${dayDate}`);
      if (container.style.display === 'none') {
        container.style.display = 'block';
        caret.style.transform = 'rotate(180deg)';
      } else {
        container.style.display = 'none';
        caret.style.transform = 'rotate(0deg)';
      }
    }

    async function saveTaskProgress(taskId, completed) {
      try {
        await fetch('/api/intensive-progress', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ taskId, completed })
        });
      } catch (error) {
        console.error('Error saving progress:', error);
      }
    }

    // Load on page load
    loadCurriculum();
  </script>
{% endblock %}
